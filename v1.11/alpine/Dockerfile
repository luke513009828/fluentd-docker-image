# AUTOMATICALLY GENERATED
# DO NOT EDIT THIS FILE DIRECTLY, USE /Dockerfile.template.erb

FROM centos
LABEL maintainer "Fluentd developers <fluentd@googlegroups.com>"
LABEL Description="Fluentd docker image" Vendor="Fluent Organization" Version="1.11.3"

RUN yum install ruby -y \
 && ruby -v \
 && gem sources -a http://mirrors.aliyun.com/rubygems/ \
 && gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB  \
 && curl -sSL https://get.rvm.io | bash -s stable  \
 && source /etc/profile.d/rvm.sh  \
 && rvm -v  \
 && rvm install 2.5  \
 && ruby -v  \
 && gem sources --remove https://rubygems.org/  \
 && yum install gcc gcc-c++ make automake autoconf libtool openssl-devel jemalloc-devel gmp-devel -y  \
 && gem install fluentd --no-ri --no-rdoc  \
 && gem install fluent-plugin-kafka --no-ri --no-rdoc  \
 && gem install fluent-plugin-elasticsearch --no-ri --no-rdoc  \
 && fluentd --setup /etc/fluentd
 

# RUN apk update \
#  && apk add --no-cache \
#         ca-certificates \
#         ruby ruby-irb ruby-etc ruby-webrick \
#         tini \
#  && apk add --no-cache --virtual .build-deps \
#         build-base linux-headers \
#         ruby-dev gnupg \
#  && echo 'gem: --no-document' >> /etc/gemrc \
#  && gem install oj -v 3.8.1 \
#  && gem install json -v 2.3.0 \
#  && gem install async-http -v 0.50.7 \
#  && gem install ext_monitor -v 0.1.2 \
#  && gem install fluentd -v 1.11.3 \
#  && gem install bigdecimal -v 1.4.4 \
#  && apk del .build-deps \
#  && rm -rf /tmp/* /var/tmp/* /usr/lib/ruby/gems/*/cache/*.gem /usr/lib/ruby/gems/2.*/gems/fluentd-*/test

# RUN addgroup -S fluent && adduser -S -g fluent fluent \
#     # for log storage (maybe shared with host)
#     && mkdir -p /fluentd/log \
#     # configuration/plugins path (default: copied from .)
#     && mkdir -p /fluentd/etc /fluentd/plugins \
#     && chown -R fluent /fluentd && chgrp -R fluent /fluentd


# COPY fluent.conf /fluentd/etc/
# COPY entrypoint.sh /bin/


# ENV FLUENTD_CONF="fluent.conf"

# ENV LD_PRELOAD=""
EXPOSE 24224 5140

# USER fluent
# ENTRYPOINT ["tini",  "--", "/bin/entrypoint.sh"]
CMD ["fluentd", "-c", "/etc/fluentd/fluent.conf"]

